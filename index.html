<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>City Defender - 城市保衛戰</title>
    <style>
        body {
            margin: 0;
            background: #050510;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: white;
            font-family: Arial, sans-serif;
        }
        canvas {
            border: 4px solid #333;
            background: linear-gradient(to bottom, #001f3f 0%, #000000 100%);
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        #ui {
            position: absolute;
            top: 20px;
            left: 20px;
            pointer-events: none;
        }
    </style>
</head>
<body>

    <div id="ui">
        <h2 id="score">分數: 0</h2>
        <p>控制：左右方向鍵移動，空白鍵射擊</p>
    </div>
    <canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreElement = document.getElementById('score');

    canvas.width = 600;
    canvas.height = 800;

    // 遊戲狀態
    let score = 0;
    let gameOver = false;

    // 玩家設定
    const player = {
        x: canvas.width / 2 - 25,
        y: canvas.height - 60,
        w: 50,
        h: 30,
        speed: 7,
        color: '#00d4ff'
    };

    // 陣列存儲
    let bullets = [];
    let enemies = [];
    let buildings = [];

    // 初始化城市背景剪影
    function initBuildings() {
        for (let i = 0; i < 10; i++) {
            buildings.push({
                x: i * 70,
                w: 60 + Math.random() * 40,
                h: 100 + Math.random() * 200,
                color: '#0a0a1a'
            });
        }
    }

    // 監聽按鍵
    const keys = {};
    window.addEventListener('keydown', e => keys[e.code] = true);
    window.addEventListener('keyup', e => keys[e.code] = false);

    // 產生敵人
    function spawnEnemy() {
        if (Math.random() < 0.03) {
            enemies.push({
                x: Math.random() * (canvas.width - 40),
                y: -50,
                w: 40,
                h: 40,
                speed: 2 + Math.random() * 3,
                color: '#ff4444'
            });
        }
    }

    function update() {
        if (gameOver) return;

        // 玩家移動
        if (keys['ArrowLeft'] && player.x > 0) player.x -= player.speed;
        if (keys['ArrowRight'] && player.x < canvas.width - player.w) player.x += player.speed;

        // 射擊
        if (keys['Space']) {
            if (bullets.length === 0 || bullets[bullets.length - 1].y < player.y - 100) {
                bullets.push({ x: player.x + player.w/2 - 2, y: player.y, w: 4, h: 15, speed: 10 });
            }
        }

        // 子彈移動
        bullets.forEach((b, i) => {
            b.y -= b.speed;
            if (b.y < 0) bullets.splice(i, 1);
        });

        // 敵人移動與碰撞
        spawnEnemy();
        enemies.forEach((en, ei) => {
            en.y += en.speed;

            // 檢查是否漏掉敵人
            if (en.y > canvas.height) {
                gameOver = true;
                alert("城市被摧毀了！最終得分: " + score);
                location.reload();
            }

            // 碰撞子彈
            bullets.forEach((b, bi) => {
                if (b.x < en.x + en.w && b.x + b.w > en.x && b.y < en.y + en.h && b.y + b.h > en.y) {
                    enemies.splice(ei, 1);
                    bullets.splice(bi, 1);
                    score += 10;
                    scoreElement.innerText = `分數: ${score}`;
                }
            });
        });
    }

    function draw() {
        // 清除畫布
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // 畫建築物 (背景城市)
        ctx.fillStyle = '#050510';
        buildings.forEach(b => {
            ctx.fillRect(b.x, canvas.height - b.h, b.w, b.h);
            // 窗戶
            ctx.fillStyle = '#1a1a3a';
            ctx.fillRect(b.x + 10, canvas.height - b.h + 20, 10, 10);
        });

        // 畫玩家 (坦克/戰機)
        ctx.fillStyle = player.color;
        ctx.fillRect(player.x, player.y, player.w, player.h);
        ctx.fillRect(player.x + player.w/2 - 5, player.y - 10, 10, 10); // 砲台

        // 畫子彈
        ctx.fillStyle = '#ffff00';
        bullets.forEach(b => ctx.fillRect(b.x, b.y, b.w, b.h));

        // 畫敵人
        enemies.forEach(en => {
            ctx.fillStyle = en.color;
            ctx.fillRect(en.x, en.y, en.w, en.h);
            // 敵人裝飾
            ctx.strokeStyle = 'white';
            ctx.strokeRect(en.x + 5, en.y + 5, en.w - 10, en.h - 10);
        });

        requestAnimationFrame(() => {
            update();
            draw();
        });
    }

    initBuildings();
    draw();
</script>
</body>
</html>
